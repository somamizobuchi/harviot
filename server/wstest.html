<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>

<body>
	<image id="plant-live-stream" width="320" height="240" controls />
	<input type="range" min="0" max="255" value="0" name="light-r" id="lightR">
	<input type="range" min="0" max="255" value="0" name="light-g" id="lightG">
	<input type="range" min="0" max="255" value="0" name="light-b" id="lightB">
	<button id="videoToggle">Video On/Off</button>
	<button id="lightToggle">Light On/Off</button>
</body>

<script>

	const control = {
		pump: 0,
		light_r: 1,
		light_g: 2,
		light_b: 3
	}

	var image = document.querySelector("#plant-live-stream")
	var set = [0, 0]
	let ws = new WebSocket("ws://localhost:8080?plant_id=6021f39b3e64fd8d1fc5c2aa")
	var videoState = false;

	document.getElementById("videoToggle").addEventListener('click', (ev) => {
		ev.preventDefault();
		videoState = !videoState
		set[5] = videoState ? 1 : 0;
		console.log("Video");
		ws.send(JSON.stringify({
			target: "6021f39b3e64fd8d1fc5c2aa",
			set
		}))
	})
	var light_r = document.getElementById("lightR")
	light_r.onchange = (ev) => {
		set[0] = control.light_r
		set[1] = light_r.value
		ws.send(JSON.stringify({
			target: "6021f39b3e64fd8d1fc5c2aa",
			set
		}))
	}
	var light_g = document.getElementById("lightG")
	light_g.onchange = (ev) => {
		set[0] = control.light_g
		set[1] = light_g.value
		console.log(light_g.value)
		ws.send(JSON.stringify({
			target: "6021f39b3e64fd8d1fc5c2aa",
			set
		}))
	}
	var light_b = document.getElementById("lightB")
	light_b.onchange = (ev) => {
		set[0] = control.light_b
		set[1] = light_b.value
		ws.send(JSON.stringify({
			target: "6021f39b3e64fd8d1fc5c2aa",
			set
		}))
	}
	document.getElementById("lightToggle").addEventListener('click', (ev) => {
		ev.preventDefault();
		ws.send(JSON.stringify({
			target: "6021f39b3e64fd8d1fc5c2aa",
			set
		}))
	})
	ws.opopen = function (ev) {
		console.log("connected")
	}
	ws.onmessage = function (ev) {
		var url = window.URL.createObjectURL(ev.data)
		image.src = url
	}
	ws.onclose = function (ev) {
		console.log("closed")
	}

</script>

</html>